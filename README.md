# 批量认证文件管理前端

基于 Vue 3 的轻量级批量认证文件管理工具，用于 [CLIProxyAPI](https://github.com/router-for-me/CLIProxyAPI)。

## 特性

- ✅ **表格化展示** - 替代卡片式，信息更密集，适合大量数据
- ✅ **批量操作** - 批量启用/禁用/删除认证文件
- ✅ **批量字段修改** - 批量修改JSON文件内的字段（如proxy_url、prefix等）
- ✅ **配额查询** - 支持查询 Antigravity、Gemini CLI、Codex 的配额使用情况
- ✅ **搜索过滤** - 按文件名搜索，按类型过滤
- ✅ **文件管理** - 上传、下载、编辑、查看模型
- ✨ **AI 提供商配置管理** - 新增！统一管理 Gemini、Claude、Codex、Vertex AI、OpenAI 等提供商配置

## 技术栈

- Vue 3 + Vite
- Element Plus
- Pinia
- Axios

## 快速开始

### 1. 安装依赖

```bash
cd batch-auth-manager
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

访问 `http://localhost:5174`

### 3. 连接到 CLIProxyAPI

1. 点击"连接服务器"
2. 输入 API 地址（如 `http://localhost:8317`）
3. 输入管理密钥
4. 点击连接

### 4. 开始使用

#### Tab 导航
- **认证文件** - 管理认证文件（原有功能）
- **AI 提供商** - 管理 AI 提供商配置（新增）
- **仪表盘** - 查看统计数据（原有功能）

#### 认证文件管理
- 查看认证文件列表
- 勾选文件后使用批量操作
- **批量修改字段** - 选择文件后，点击"批量修改字段"，可以批量设置proxy_url、prefix等字段
- 上传新文件或管理现有文件

#### AI 提供商配置管理 🆕
- 查看所有 AI 提供商配置（Gemini、Claude、Codex、Vertex AI、OpenAI）
- 按类型筛选和搜索提供商
- 批量删除提供商
- 查看 API Key（脱敏显示）
- 查看启用状态和优先级

> 详细功能说明请查看 [AI_PROVIDERS_FEATURE.md](./AI_PROVIDERS_FEATURE.md)

## 批量字段修改功能

这是本工具的核心特性，支持批量修改认证文件（JSON）内的字段：

### 支持的字段

- **proxy_url** - 代理地址（如 `http://proxy.example.com:8080`）
- **prefix** - 模型前缀（如 `gemini/`）
- **自定义字段** - 任意JSON字段

### 使用步骤

1. 勾选要修改的文件
2. 点击"批量修改字段"按钮
3. 选择要修改的字段（或输入自定义字段名）
4. 输入字段值（留空表示删除该字段）
5. 点击"应用修改"

### 工作原理

1. 下载每个选中的JSON文件
2. 解析JSON并修改指定字段
3. 重新上传文件（覆盖原文件）
4. 显示每个文件的处理结果

### 示例

**批量设置代理：**
- 字段：`proxy_url`
- 值：`http://127.0.0.1:7890`
- 结果：所有选中文件的 `proxy_url` 字段被设置为该值

**批量删除前缀：**
- 字段：`prefix`
- 值：（留空）
- 结果：所有选中文件的 `prefix` 字段被删除

## 配额查询功能

支持查询认证文件的配额使用情况，**直接在表格中显示配额状态**：

### 支持的类型

- **Antigravity** - 显示各模型组的配额使用情况
- **Gemini CLI** - 显示各模型桶的配额使用情况
- **Codex** - 显示订阅类型和速率限制

### 使用方法

#### 1. 表格中查看配额摘要

在认证文件列表的"配额状态"列中，可以直观看到：
- **未查询** - 灰色"未查询"提示
- **查询中** - 蓝色loading动画
- **已查询** - 显示最严重的配额状态（如：🟢 Claude 25% 或 🔴 Gemini 5%）
  - 🟢 绿色：剩余 ≥ 50%
  - 🟠 橙色：剩余 20-50%
  - 🔴 红色：剩余 < 20%

点击配额单元格可查看详细信息。

#### 2. 批量刷新配额

1. 勾选需要查询配额的文件（支持 Antigravity/Gemini CLI/Codex）
2. 点击"刷新配额"按钮（批量操作栏）
3. 系统自动并发查询（5个一批）
4. 查询结果显示在表格的"配额状态"列

#### 3. 查看详细配额

1. 点击表格中的配额单元格，或
2. 点击操作列的"配额"按钮
3. 弹窗自动显示详细配额信息
4. 可点击"刷新"按钮重新查询

### 智能缓存

- 配额数据自动缓存 5 分钟
- 避免重复查询，提高响应速度
- 配额状态持久化（刷新页面前有效）

### 重要说明

- ✅ **会使用代理** - 配额查询通过 `/v0/management/api-call` 接口
- ✅ **自动使用认证文件的 proxy_url**（如果设置了）
- ✅ **自动使用全局 proxy-url**（如果文件未设置）
- ⚠️ 查询可能需要几秒钟，请耐心等待

## 生产构建

```bash
npm run build
```

构建产物在 `dist/` 目录。

## 重要说明

### 关于 proxy_url 字段

本工具可以批量修改认证文件（JSON）内的 `proxy_url` 字段：

- ✅ **支持批量设置** - 选中多个文件，统一设置 proxy_url
- ✅ **文件级别配置** - 每个认证文件可以有独立的 proxy_url
- ⚠️ **注意** - CLIProxyAPI 也有全局 proxy_url 配置，文件级别的配置优先级取决于后端实现

### 关于批量操作

由于后端没有批量接口，批量操作通过逐个调用 API 实现：

- 10 个文件：约 2 秒
- 50 个文件：约 10 秒

建议分批操作大量文件。

## 与原管理界面对比

| 特性 | 原管理界面 | 批量管理界面 |
|------|-----------|------------|
| 功能范围 | 全面（配置、日志、统计等） | 专注认证文件 |
| 展示方式 | 卡片式 | 表格式 |
| 批量操作 | ❌ | ✅ |
| 适用场景 | 日常维护、精细管理 | 批量导入、批量清理 |

## 使用建议

- **日常维护** - 使用原管理界面
- **批量导入** - 使用本工具
- **批量清理** - 使用本工具
- **快速查看** - 使用本工具（表格视图）

## 许可证

MIT
